<!DOCTYPE html>
<html>

<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Map test</title>

  <style>
    
  </style>

  
</head>
<body>
  <!DOCTYPE html>
<html>
<head>
    <title>Live Flight Tracker</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Leaflet CSS and JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }
        #map {
            width: 100vw;
            height: 100vh;
        }

        /* Custom Airplane Icon Style */
        .airplane-icon {
            width: 50px;
            height: 50px;
            /* Validated and properly encoded SVG */
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cpath fill='%23FFC700' stroke='black' stroke-width='3' d='M50 0 L55 35 L98 48 L98 52 L55 65 L55 85 L70 90 L70 95 L52 95 L50 100 L48 95 L30 95 L30 90 L45 85 L45 65 L2 52 L2 48 L45 35 Z'/%3E%3C/svg%3E");
            background-size: contain;
            background-repeat: no-repeat;
            transition: transform 0.2s linear; /* Smooth rotation */
        }

        /* Custom Info Box (styled Leaflet tooltip) */
        .flight-info-tooltip {
            background-color: white;
            border: 0;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            padding: 12px;
            white-space: nowrap;
        }

        .flight-info-tooltip .flight-model {
            font-weight: bold;
            color: #111;
        }
        .flight-info-tooltip .flight-number-line {
            display: flex;
            align-items: center;
            gap: 6px;
            margin: 4px 0;
        }
        .flight-info-tooltip .flight-route {
            color: #444;
        }
        .flight-info-tooltip .flag-emoji {
            font-size: 18px;
            line-height: 1;
        }
    </style>
</head>
<body>

<div id="map"></div>

<script>
    const londonCoordinates = [51.478431, -0.113217];
    const map = L.map('map').setView(londonCoordinates, 9);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
        maxZoom: 18,
    }).addTo(map);

    const flightMarkers = {};

    function fetchFlightData() {
        const bounds = map.getBounds();
        const url = `https://opensky-network.org/api/states/all?lamin=${bounds.getSouth()}&lomin=${bounds.getWest()}&lamax=${bounds.getNorth()}&lomax=${bounds.getEast()}`;

        fetch(url)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                const receivedIcaos = new Set();

                if (data && data.states) {
                    data.states.forEach(flight => {
                        const icao24 = flight[0];
                        const callsign = flight[1] ? flight[1].trim() : 'N/A';
                        const origin_country = flight[2];
                        const longitude = flight[5];
                        const latitude = flight[6];
                        const altitude = flight[7] ? Math.round(flight[7]) + 'm' : 'N/A';
                        const on_ground = flight[8];
                        const true_track = flight[10];

                        if (!icao24 || !latitude || !longitude || on_ground) {
                            return;
                        }

                        receivedIcaos.add(icao24);

                        const position = [latitude, longitude];
                        const tooltipContent = `
                            <div class="flight-model">Aircraft</div>
                            <div class="flight-number-line">
                                <span class="flag-emoji">✈️</span>
                                <span>${callsign}</span>
                            </div>
                            <div class="flight-route">${origin_country} (${altitude})</div>
                        `;

                        if (flightMarkers[icao24]) {
                            flightMarkers[icao24].setLatLng(position);
                            flightMarkers[icao24].getTooltip().setContent(tooltipContent);
                            const iconElement = flightMarkers[icao24].getElement().querySelector('.airplane-icon');
                            if (iconElement && true_track !== null) {
                                iconElement.style.transform = `rotate(${true_track}deg)`;
                            }
                        } else {
                            const airplaneIcon = L.divIcon({
                                className: 'custom-div-icon',
                                html: `<div class="airplane-icon" style="transform: rotate(${true_track || 0}deg);"></div>`,
                                iconSize: [50, 50],
                                iconAnchor: [25, 25]
                            });

                            const marker = L.marker(position, { icon: airplaneIcon }).addTo(map);
                            marker.bindTooltip(tooltipContent, {
                                permanent: true,
                                direction: 'bottom',
                                offset: L.point(0, 20),
                                className: 'flight-info-tooltip'
                            });
                            flightMarkers[icao24] = marker;
                        }
                    });
                }

                // Clean up markers for flights no longer in view
                for (const icao in flightMarkers) {
                    if (!receivedIcaos.has(icao)) {
                        map.removeLayer(flightMarkers[icao]);
                        delete flightMarkers[icao];
                    }
                }
            })
            .catch(error => {
                console.error('Error fetching flight data:', error);
            });
    }

    fetchFlightData();
    setInterval(fetchFlightData, 10000);
</script>

</body>
</html>

  <script>
    
  </script>
</body>
</html>
